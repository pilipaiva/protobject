<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>C치mara Lector ArUco</title>
    <style>
      body { margin: 0; background: black; overflow: hidden; }
      #status {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 10px 20px;
        border-radius: 8px;
        background: rgba(0,0,0,0.6);
        color: white;
        font-family: sans-serif;
        font-size: 16px;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <div id="status">Inicializando c치mara...</div>

    <!-- MUY IMPORTANTE: seg칰n la doc, estos scripts van APENAS debajo de <body> -->
    <script src="https://app.protobject.com/framework/p.js"></script>
    <script src="config.js"></script>

    <script>
      const statusDiv = document.getElementById("status");

      // 1) Empezar la detecci칩n de ArUco (igual que en el ejemplo)
      //    genera eventos cada 200 ms, usa la c치mara con id 0 (webcam por defecto)
      Protobject.Aruco.start(200, 0);

      // 2) Mostrar la vista previa de la c치mara
      //    (a pantalla completa)
      Protobject.Aruco.showPreview({
        top: 0,
        left: 0,
        width: window.innerWidth,
        height: window.innerHeight
      });

      statusDiv.textContent = "C치mara lista, apunta un c칩digo ArUco.";

      // 3) Recibir datos de los marcadores
      Protobject.Aruco.onData((data) => {
        // data tiene forma: { "id": { position: {x,y}, size }, ... }
        const ids = Object.keys(data).map(id => Number(id));
        console.log("游닝 ArUco data:", data, "IDs:", ids);

        if (ids.length > 0) {
          // Enviar los IDs a la p치gina de la luz
          Protobject.Core.send(ids).to("luz.html");

          statusDiv.textContent = "Detectado: " + ids.join(", ");
          statusDiv.style.background = "rgba(0,128,0,0.6)";
        } else {
          // Si no ve nada, mandamos lista vac칤a
          Protobject.Core.send([]).to("luz.html");

          statusDiv.textContent = "No se detectan c칩digos.";
          statusDiv.style.background = "rgba(0,0,0,0.6)";
        }
      });
    </script>
  </body>
</html>

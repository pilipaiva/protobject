<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>C√°mara Lector ArUco</title>
    <style>
      body { margin: 0; background: black; overflow: hidden; }
      #status {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 10px 20px;
        border-radius: 8px;
        background: rgba(0,0,0,0.6);
        color: white;
        font-family: sans-serif;
        font-size: 16px;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <body>
  <div id="status"
       style="position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
              padding:10px 20px;border-radius:8px;
              background:rgba(0,0,0,0.6);color:white;
              font-family:sans-serif;z-index:10;">
    Toca el bot√≥n para iniciar la c√°mara.
  </div>

  <button id="startBtn"
          style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
                 padding:12px 24px;border-radius:8px;border:none;
                 background:#007bff;color:white;font-size:16px;
                 font-family:sans-serif;z-index:20;">
    Iniciar c√°mara
  </button>

  <script src="https://app.protobject.com/framework/p.js"></script>
  <script src="config.js"></script>

    <div id="status">Inicializando c√°mara...</div>
    

     <script>
    const statusDiv = document.getElementById("status");
    const startBtn  = document.getElementById("startBtn");

    function initAruco() {
      // Ocultamos el bot√≥n, ya hubo interacci√≥n
      startBtn.style.display = "none";
      statusDiv.textContent  = "Inicializando c√°mara...";

      // Mostrar vista previa (video)
      Protobject.Aruco.showPreview({
        top: 0,
        left: 0,
        width: window.innerWidth,
        height: window.innerHeight
      });

      // Intentamos c√°mara trasera (1), si no, frontal (0)
      try {
        Protobject.Aruco.start(60, 1);
        console.log("‚úÖ ArUco start(60, 1)");
      } catch (e) {
        console.warn("No se pudo usar c√°mara 1, probando con 0:", e);
        try {
          Protobject.Aruco.start(60, 0);
          console.log("‚úÖ ArUco start(60, 0)");
        } catch (err) {
          console.error("‚ùå No se pudo iniciar ArUco:", err);
          statusDiv.textContent = "No se pudo iniciar la c√°mara. Revisa permisos.";
          statusDiv.style.background = "rgba(128,0,0,0.6)";
          return;
        }
      }

      statusDiv.textContent = "C√°mara lista, apunta un c√≥digo ArUco.";

      // Callback de detecci√≥n
      Protobject.Aruco.onData((data) => {
        const ids = Object.keys(data).map(id => Number(id));
        console.log("üì∑ ArUco data:", data, "IDs:", ids);

        if (ids.length > 0) {
          Protobject.Core.send(ids).to("index.html");
          statusDiv.textContent = "Detectado: " + ids.join(", ");
          statusDiv.style.background = "rgba(0,128,0,0.6)";
        } else {
          Protobject.Core.send([]).to("index.html");
          statusDiv.textContent = "No se detectan c√≥digos.";
          statusDiv.style.background = "rgba(0,0,0,0.6)";
        }
      });
    }

    // Muy importante: iniciar SOLO en respuesta a un tap
    startBtn.addEventListener("click", initAruco);
  </script>
</body>
</html>


  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>C치mara Lector ArUco</title>

    <style>
      body {
        margin: 0;
        background: black;
        overflow: hidden;
      }

      #status {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 10px 20px;
        border-radius: 8px;
        background: rgba(0,0,0,0.6);
        color: white;
        font-family: sans-serif;
        font-size: 16px;
        z-index: 10;
      }

      #startBtn {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 12px 24px;
        border-radius: 8px;
        border: none;
        background: #007bff;
        color: white;
        font-size: 16px;
        font-family: sans-serif;
        z-index: 20;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <div id="status">Toca el bot칩n para iniciar la c치mara.</div>
    <button id="startBtn">Iniciar c치mara</button>

    <script src="https://app.protobject.com/framework/p.js"></script>
    <script src="config.js"></script>

    <script>
      const statusDiv = document.getElementById("status");
      const startBtn  = document.getElementById("startBtn");

      function initAruco() {
        startBtn.style.display = "none";
        statusDiv.textContent  = "Inicializando c치mara...";

        // Muestra la vista previa de la c치mara (como en el ejemplo oficial)
        Protobject.Aruco.showPreview({
          top: 0,
          left: 0,
          width: 1280 / 3,
          height: 720 / 3
        });

        // Inicia el sistema de detecci칩n (como en el ejemplo)
        // La c치mara genera eventos cada 30 ms y usa la c치mara con id 1
        Protobject.Aruco.start(30, 1);

        statusDiv.textContent = "C치mara lista, apunta un c칩digo ArUco.";

        Protobject.Aruco.onData((data) => {
          const ids = Object.keys(data).map(id => Number(id));
          console.log("游닝 ArUco data:", data, "IDs:", ids);

          if (ids.length > 0) {
            Protobject.Core.send(ids).to("index.html");
            statusDiv.textContent = "Detectado: " + ids.join(", ");
            statusDiv.style.background = "rgba(0,128,0,0.6)";
          } else {
            Protobject.Core.send([]).to("index.html");
            statusDiv.textContent = "No se detectan c칩digos.";
            statusDiv.style.background = "rgba(0,0,0,0.6)";
          }
        });
      }

      // Muy importante: solo arrancar ArUco despu칠s del click
      startBtn.addEventListener("click", initAruco);
    </script>
  </body>
</html>

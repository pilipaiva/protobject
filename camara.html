<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>C√°mara Lector ArUco</title>
    <style>
      body { margin: 0; background: black; overflow: hidden; }
      #status {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 10px 20px;
        border-radius: 8px;
        background: rgba(0,0,0,0.6);
        color: white;
        font-family: sans-serif;
        font-size: 16px;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <div id="status">Inicializando c√°mara...</div>

    <!-- MUY IMPORTANTE: seg√∫n la doc, estos scripts van APENAS debajo de <body> -->
    <script src="https://app.protobject.com/framework/p.js"></script>
    <script src="config.js"></script>

   <script>
  const statusDiv = document.getElementById("status");

  // 1) Mostrar vista previa de la c√°mara (m√°s liviano)
  Protobject.Aruco.showPreview({
    top: 0,
    left: 0,
    width: window.innerWidth,
    height: window.innerHeight
    // Si sigue pesado, puedes probar width: 1280/3, height: 720/3
  });

  // 2) Intentar usar la c√°mara trasera (id = 1), si falla probamos con 0
  function startAruco() {
    try {
      // Intervalo 60ms (no tan agresivo como 30ms, mejor para celular)
      Protobject.Aruco.start(60, 1); // üëà trasera
      statusDiv.textContent = "C√°mara lista, apunta un c√≥digo ArUco.";
      console.log("‚úÖ ArUco start(60, 1)");
    } catch (e) {
      console.warn("No se pudo usar c√°mara 1, probando con 0:", e);
      try {
        Protobject.Aruco.start(60, 0); // üëà frontal como fallback
        statusDiv.textContent = "C√°mara lista (cam 0), apunta un c√≥digo ArUco.";
        console.log("‚úÖ ArUco start(60, 0)");
      } catch (err) {
        console.error("‚ùå No se pudo iniciar ArUco:", err);
        statusDiv.textContent = "No se pudo iniciar la c√°mara. Revisa permisos.";
        statusDiv.style.background = "rgba(128,0,0,0.6)";
      }
    }
  }

  startAruco();

  // 3) Recibir datos de los marcadores
  Protobject.Aruco.onData((data) => {
    const ids = Object.keys(data).map(id => Number(id));
    console.log("üì∑ ArUco data:", data, "IDs:", ids);

    if (ids.length > 0) {
      Protobject.Core.send(ids).to("index.html");
      statusDiv.textContent = "Detectado: " + ids.join(", ");
      statusDiv.style.background = "rgba(0,128,0,0.6)";
    } else {
      Protobject.Core.send([]).to("index.html");
      statusDiv.textContent = "No se detectan c√≥digos.";
      statusDiv.style.background = "rgba(0,0,0,0.6)";
    }
  });
</script>

  </body>
</html>
